generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  password  String
  role      Role     @default(STAFF)
  createdAt DateTime @default(now())
}

model Farmer {
  id          String           @id @default(uuid())
  farmerCode  String           @unique
  name        String
  phone       String?
  address     String?
  milkType    MilkType         @default(COW)
  rateType    RateType         @default(FAT_SNF)
  fatRate     Float            @default(0)
  snfRate     Float            @default(0)
  fixedRate   Float            @default(0)
  active      Boolean          @default(true)
  createdAt   DateTime         @default(now())
  advances    Advance[]
  collections MilkCollection[]
}

model MilkCollection {
  id          String   @id @default(uuid())
  date        DateTime @default(now())
  shift       Shift
  quantity    Float
  fat         Float    @default(0)
  snf         Float    @default(0)
  rate        Float
  totalAmount Float
  farmerId    String
  farmer      Farmer   @relation(fields: [farmerId], references: [id])
}

model Advance {
  id          String   @id @default(uuid())
  date        DateTime @default(now())
  amount      Float
  description String?
  farmerId    String
  farmer      Farmer   @relation(fields: [farmerId], references: [id])
}

model Product {
  id           String @id @default(uuid())
  name         String @unique
  unit         String
  stock        Float  @default(0)
  sellingPrice Float  @default(0)
  sales        Sale[]
}

model Sale {
  id           String   @id @default(uuid())
  date         DateTime @default(now())
  customerName String
  quantity     Float
  fat          Float?   @default(0)
  snf          Float?   @default(0)
  rate         Float
  totalAmount  Float
  productId    String?
  product      Product? @relation(fields: [productId], references: [id])
}

model Expense {
  id          String   @id @default(uuid())
  date        DateTime @default(now())
  category    String
  amount      Float
  description String?
}

model CompanySettings {
  id          Int     @id @default(1)
  companyName String  @default("My Dairy Farm")
  ownerName   String?
  phone       String?
  address     String?
  email       String?
  billNote    String? @default("Thank you for your business!")
}

model Production {
  id          String   @id @default(uuid())
  date        DateTime @default(now())
  productName String
  milkUsed    Float
  milkType    String
  outputQty   Float
  yield       Float
  notes       String?
}

enum Role {
  OWNER
  MANAGER
  STAFF
  ACCOUNTANT
}

enum MilkType {
  COW
  BUFFALO
}

enum RateType {
  FAT_ONLY
  FAT_SNF
  FIXED
}

enum Shift {
  MORNING
  EVENING
}
